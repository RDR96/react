import {
  PayableDetails,
  MercoaSession,
  PayableForm,
  PayableFormHeader,
  PayableCounterpartySearch,
  PayableOverview,
  PayableLineItems,
  PayableMetadata,
  PayablePaymentSource,
  PayablePaymentDestination,
  PaymentDestinationProcessingTime,
  PayableApprovers,
  InvoiceComments,
  PayableFees,
  PayableActions
} from '@mercoa/react'
import { payerEntity, vendorEntities, inv_new_ready, inv_scheduled } from '../../../mockData'
import { ComponentContainer } from '../../../components/helpers'
import { Callout } from 'nextra/components'
import { useEffect } from 'react'

# Payable Details

The `<PayableDetails>` component is used to let users create and manage payable invoices.

## Customization Options

| Themeable | Variations | Custom Component |
| :-------: | :--------: | :--------------: |
|    ✅     |     ✅     |        ✅        |

## Props

| Name                  | Type                                                                                 | Required | Description                                                                                                                                           |
| :---------------------| :------------------------------------------------------------------------------------| :--------| :-----------------------------------------------------------------------------------------------------------------------------------------------------|
| invoiceId             | `string`                                                                             |          | The ID of the invoice to edit. Leave blank if creating a new invoice                                                                                  |
| onUpdate              | `(invoice: InvoiceResponse \| undefined) => void`                                    |          | When the invoice is created, updated, or deleted, this callback is triggered                                                                          |
| heightOffset          | `number`                                                                             |          | This component uses the screen size to set its height. If you have other elements on the screen, increase the height offset to shrink this component. |
| documentPosition      | `'right' \| 'left' \| 'none'`                                                        |          | Control where to place the invoice doucment (or hide it). Default is `left`                                                                           |
| invoicePreSubmit      | `(invoice: Mercoa.InvoiceCreationRequest) => Promise<Mercoa.InvoiceCreationRequest>` |          | This function is called after frontend validations are complete, and before the API call to create/update the invoice is sent.                        |
| counterpartyPreSubmit | `(counterparty: Mercoa.EntityRequest \| Mercoa.EntityUpdateRequest \| undefined) => Promise<Mercoa.EntityRequest \| Mercoa.EntityUpdateRequest \| undefined>` |          | Function to call before an entity is submitted to Mercoa. Useful for adding custom fields to the entity or preventing submission |
| children              | `(methods: PayableDetailsChildrenProps) => JSX.Element[]`                            |          | See [customization](#customization) for details on how to use the children prop.                                                                      |

```typescript
type PayableDetailsChildrenProps = {
  invoice?: Mercoa.InvoiceResponse
  ocrResponse?: Mercoa.OcrResponse
  uploadedDocument?: string
  onUpdate: (invoice: Mercoa.InvoiceResponse | undefined) => void
  setUploadedDocument: (e?: string) => void
  height: number
  refreshInvoice: (invoiceId: Mercoa.InvoiceId) => void
  invoicePreSubmit?: (invoice: Mercoa.InvoiceCreationRequest) => Promise<Mercoa.InvoiceCreationRequest>
  onOcrComplete: (ocrResponse?: Mercoa.OcrResponse) => void
};
```

## Examples

### Edit Existing Invoice

<ComponentContainer>
  <PayableDetails invoiceId={'inv_new_ready'} />
  ```jsx
<PayableDetails
  invoiceId={'inv_XXXXX-XXXX-XXXXXX'}
  onUpdate={(invoice) => {
    if (!invoice) {
      router.push(`/dashboard/payers/${entityId}`)
      return
    }
    router.push(`/dashboard/payers/${entityId}/invoices/${invoice.id}`)
  }}
/>
  ```
</ComponentContainer>

### Create New Invoice

<ComponentContainer>
  <PayableDetails />
  ```jsx
<PayableDetails 
  onUpdate={(invoice) => {
    if (!invoice) {
      router.push(`/dashboard/payers/${entityId}`)
      return
    }
    router.push(`/dashboard/payers/${entityId}/invoices/${invoice.id}`)
  }}
/>
  ```
</ComponentContainer>

### Document on right

<ComponentContainer>
  <PayableDetails invoiceId={'inv_new_ready'} documentPosition="right" />
  ```jsx
<PayableDetails
  documentPosition="right"
  invoiceId={'inv_XXXXX-XXXX-XXXXXX'}   
  onUpdate={(invoice) => {
    if (!invoice) {
      router.push(`/dashboard/payers/${entityId}`)
      return
    }
    router.push(`/dashboard/payers/${entityId}/invoices/${invoice.id}`)
  }}
/>
  ```
</ComponentContainer>


## Customization

The `PayableDetails` consists of the [`<PayableForm>`](./Form) and [`<PayableDocument>`](./Document) components. See those pages for how to customize them.

The default children is the following:

```tsx
<PayableDetails>
 {(props) => [
     <PayableDocument {...props} key={1} />,
     <PayableForm {...props} key={2} />
  ]}
</PayableDetails>
```